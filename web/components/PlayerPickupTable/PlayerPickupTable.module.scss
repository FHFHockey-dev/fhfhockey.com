@use "sass:color";
@use "styles/vars" as v; // Use an alias for brevity
@use "sass:math";
@use "styles/panel" as panel;

// Define border color and width as variables for consistency
$metric-border-color: v.$secondary-color;
$selected-border-width: 2px; // The width of the indicator

/* --- Position Accents (Neon Noir) --- */
.posC {
  --accent-color: #{v.$info-color};
}
.posLW {
  --accent-color: #{v.$color-orange};
}
.posRW {
  --accent-color: #{v.$color-purple};
}
.posD {
  --accent-color: #{v.$color-teal};
}
.posG {
  --accent-color: #{v.$success-color};
}
.posUTIL {
  --accent-color: #{v.$warning-color};
}

.container {
  width: 100%;
  margin: 0;
  color: v.$text-color-primary;
  font-family: v.$font-family-primary;
  transition: margin-bottom v.$transition-duration v.$transition-easing;
  display: flex;
  align-items: flex-start;
  gap: v.$space-md;
  --bpa-filters-width: 33%;
}

.container > .filters {
  flex: 0 0 var(--bpa-filters-width);
  width: var(--bpa-filters-width);
  margin: 0;
  margin-bottom: 0;
  @include panel.panel-container($radius: v.$border-radius-lg, $padding: 0);
}

.container > .collapsibleContent {
  flex: 1 1 0;
  min-width: 0;
  @include panel.panel-container($radius: v.$border-radius-lg, $padding: 0);
}

.sidebarLayout {
  gap: v.$space-md;

  .filters {
    gap: v.$space-sm;
  }

  .tableContainer {
    margin-top: v.$space-sm;
    max-height: 60vh;
    overflow-y: auto;
    @include v.custom-scrollbar(v.$secondary-color, v.$background-medium);
  }

  .pagination {
    justify-content: space-between;
    gap: v.$space-sm;
  }
}

.sidebarContent {
  margin-top: 0;
}

@media (max-width: #{v.$breakpoint-tablet - 1px}) {
  .container {
    flex-direction: column;
  }

  .container > .filters {
    flex: 0 0 auto;
    width: 100%;
    margin-bottom: v.$space-md;
  }

  .container > .collapsibleContent {
    flex: 0 0 auto;
    width: 100%;
  }
}

/* --- Filters Styling --- */
.filters {
  margin: 0;
  color: v.$text-color-primary;
  overflow: hidden;
  position: relative; // For icon
  display: flex;
  flex-direction: column;
  gap: 15px; // Consistent gap between sections (title, basic filters, metric filters, reset)
  padding: 15px;

  // Transition for filter content height/visibility
  .filterContainer, // Basic filter rows (desktop)
  .filterContainerMobile, // Basic filter rows (mobile)
  .metricFilterContainer, // Container for metric header + groups
  .buttonReset {
    // Reset button
    transition:
      max-height 0.4s v.$transition-easing,
      opacity 0.3s v.$transition-easing,
      visibility 0.3s v.$transition-easing,
      margin 0.4s v.$transition-easing,
      padding 0.4s v.$transition-easing;
    max-height: 1000px; // Arbitrary large height when visible
    opacity: 1;
    visibility: visible;
    overflow: hidden;
  }

  // --- Styles when minimized on mobile ---
  &.minimized {
    margin-bottom: 10px;
    padding-bottom: 15px; // Keep padding consistent with visible state?
    gap: 0; // Collapse gap when minimized

    // Hide filter controls, metric filters, and button
    .filterContainer,
    .filterContainerMobile,
    .metricFilterContainer,
    .buttonReset {
      max-height: 0;
      opacity: 0;
      visibility: hidden;
      margin: 0; // Remove margins
      padding: 0; // Remove padding
      border: none; // Remove borders if any
    }

    // Adjust title appearance when minimized
    .filtersTitle {
      padding-bottom: 0;
      border-bottom: none;
      margin-bottom: 0; // Remove margin below title
    }
  }

  &.sidebarFilters {
    gap: 12px;
    padding: 12px;
  }
}

.filtersTitle {
  @include panel.panel-title;
  width: 100%;
  padding-right: 40px; // Space for icon (align with others)
  border-bottom-color: v.$secondary-color;
  // Override panel-title default space-between so inline spans don't stretch apart
  justify-content: flex-start;
  gap: 8px;
  // Optional inner wrapper if we later group content
  .titleContent {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    align-items: baseline;
  }

  .titleWord {
    display: inline-flex;
    align-items: baseline;
    gap: 0;
    white-space: nowrap;
  }
  &[data-interactive="true"] {
    cursor: pointer;
  }
  @media (max-width: #{v.$breakpoint-tablet - 1px}) {
    user-select: none;
  }
}

.filtersBody {
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.minimizeToggleIcon {
  position: absolute;
  right: 10px;
  top: 40%; // Adjust vertical position as needed
  transform: translateY(-50%) rotate(0deg);
  font-size: 1.2rem;
  color: v.$secondary-color;
  transition: transform 0.3s v.$transition-easing;
  pointer-events: none; // Icon itself isn't clickable

  &.minimized {
    transform: translateY(-50%) rotate(-180deg); // Point up when minimized
  }
}

.acronym {
  color: v.$secondary-color;
  font-weight: 100;
}

/* --- Desktop Filter Layout --- */
.filterContainer {
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.filterRowGridTop {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 12px;
  align-items: stretch;
}

.filterRow {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 8px;
  padding: 10px;
  background-color: color.adjust(v.$background-dark, $lightness: 3%);
  border: 1px solid v.$border-secondary;
  border-radius: 8px;
  min-width: 200px;
  min-height: 86px; // default (overridden for the top row)
  width: 100%;
  box-sizing: border-box;
}

.filterRowGridTop .filterRow {
  min-height: 68px;
  padding: 8px 10px;
  gap: 6px;
}

.filterRowPositions {
  display: flex;
  flex-direction: row;
  align-items: center;
  min-height: 0;

  .label {
    text-align: left;
  }
}

.filterRowTeam {
  flex-direction: row;
  align-items: center;
  justify-content: space-between;
  gap: 10px;

  .label {
    margin: 0;
    white-space: nowrap;
  }

  .select {
    max-width: none;
    width: auto;
    flex: 1 1 auto;
    min-width: 0;
  }
}

.sidebarFilters {
  .filterContainer {
    flex-direction: column;
    align-items: stretch;
    gap: 12px;
  }

  .filterRow {
    max-width: none;
    width: 100%;
  }

  .filterContainerMobile {
    gap: 12px;
  }

  .ownershipTeamContainer {
    flex-direction: column;
    gap: 12px;
  }

  .filterRowMobileOwnership,
  .filterRowMobileTeam,
  .filterRowMobile {
    width: 100%;
  }

  .buttonReset {
    max-width: none;
    width: 100%;
  }
}

.label {
  font-size: 0.9em;
  font-weight: 600;
  color: v.$text-color-secondary;
}

/* --- Mobile Filter Layout --- */
.filterContainerMobile {
  display: flex;
  flex-direction: column;
  gap: 15px; // Slightly smaller gap on mobile
  width: 100%;
}

// Combined compact row for mobile/sidebar filters
.filterRowMobileCombined {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
  padding: 8px 10px;
  background-color: v.$background-medium;
  border-radius: 8px;
}

.compactField {
  display: flex;
  flex-direction: column;
  gap: 4px;
  min-width: 140px;
  flex: 1 1 180px;

  .labelMobile {
    font-size: 0.85em;
  }

  .sliderMobile {
    max-width: 200px;
  }

  .selectMobile {
    max-width: 140px;
  }
}

.compactFieldInline {
  flex-direction: row;
  align-items: center;
  justify-content: space-between;
  gap: 8px;

  .labelMobile {
    margin: 0;
    white-space: nowrap;
  }

  .selectMobile {
    flex: 1 1 auto;
    min-width: 0;
    max-width: none;
  }
}

.positionsField {
  flex: 2 1 260px;
  .positionCheckboxGroup {
    justify-content: flex-start;
    gap: 6px 10px;
  }
  .positionCheckbox {
    font-size: 0.85em;
    input[type="checkbox"] {
      width: 16px;
      height: 16px;
    }
  }
}

.ownershipTeamContainer {
  display: flex;
  flex-direction: column; // Stack Own/Team vertically on smallest screens
  gap: 15px;
  width: 100%;

  @media (min-width: 480px) {
    // Side-by-side on slightly larger mobile screens
    flex-direction: row;
    justify-content: space-around;
    align-items: flex-start; // Align tops
    gap: 20px;
  }
}

.filterRowMobileOwnership,
.filterRowMobileTeam {
  display: flex;
  flex-direction: column;
  align-items: center;
  width: 100%; // Take full width when stacked
  padding: 10px 15px; // Adjust padding
  background-color: v.$background-medium;
  border-radius: 8px;
  gap: 8px;

  @media (min-width: 480px) {
    width: 48%; // Roughly half width when side-by-side
  }
}

.filterRowMobile {
  // Container for Positions on mobile
  display: flex;
  flex-direction: column;
  align-items: center;
  width: 100%;
  gap: 10px;
  padding: 10px 15px;
  background-color: v.$background-medium;
  border-radius: 8px;

  > span {
    // The label ("Positions:", etc.)
    font-size: 0.9em;
    font-weight: 600;
    color: v.$text-color-secondary;
    margin-bottom: 5px;
  }
}

.positionCheckboxGroup {
  display: flex;
  flex-wrap: nowrap;
  justify-content: space-evenly;
  gap: 10px;
  width: 100%;
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
}

.labelMobile {
  font-size: 0.9em;
  font-weight: 600;
  color: v.$text-color-secondary;
  text-align: center;
}

/* --- Input Styling (Common & Specific) --- */
@mixin range-track {
  width: 100%;
  height: 8px;
  cursor: pointer;
  background: v.$background-light;
  border-radius: 4px;
  border: 1px solid v.$border-color-secondary;
}
@mixin range-thumb {
  height: 18px;
  width: 18px;
  border-radius: 50%;
  background: v.$primary-color;
  cursor: pointer;
  border: 2px solid v.$text-color-primary;
  margin-top: -6px; // Adjust thumb position vertically relative to track
}

.slider,
.sliderMobile {
  appearance: none;
  width: 100%;
  max-width: 250px; // Limit slider width
  height: 18px; // Ensure consistent height for focus styles
  background: transparent; // Track styled separately
  cursor: pointer;
  &:focus {
    outline: none;
  }
  &::-webkit-slider-runnable-track {
    @include range-track;
  }
  &::-moz-range-track {
    @include range-track;
  }
  &::-webkit-slider-thumb {
    appearance: none;
    @include range-thumb;
  }
  &::-moz-range-thumb {
    @include range-thumb;
    border: 0; // FF needs border 0 on thumb
  }
  &:focus::-webkit-slider-thumb {
    box-shadow: 0 0 0 3px rgba(v.$primary-color, 0.5);
  }
  &:focus::-moz-range-thumb {
    box-shadow: 0 0 0 3px rgba(v.$primary-color, 0.5);
  }
}

.select,
.selectMobile {
  appearance: none;
  background-color: v.$background-dark;
  border: 1px solid v.$border-secondary;
  border-radius: 6px;
  padding: 8px 30px 8px 10px; // Space for arrow
  font-size: 0.9em;
  color: v.$text-color-primary;
  cursor: pointer;
  width: 100%;
  max-width: 150px; // Limit select width
  // Custom arrow
  background-image:
    linear-gradient(45deg, transparent 50%, v.$primary-color 50%),
    linear-gradient(135deg, v.$primary-color 50%, transparent 50%);
  background-position:
    calc(100% - 15px) center,
    calc(100% - 10px) center;
  background-size:
    5px 5px,
    5px 5px;
  background-repeat: no-repeat;
  &:focus {
    outline: none;
    border-color: v.$primary-color;
    box-shadow: 0 0 0 2px rgba(v.$primary-color, 0.3);
  }
}

.positionCheckbox {
  // Style for position checkboxes LABEL
  display: inline-flex;
  align-items: center;
  cursor: pointer;
  font-size: 0.9em;
  gap: 6px;
  white-space: nowrap;
  flex: 0 0 auto;

  input[type="checkbox"] {
    // Style for position INPUT checkbox
    appearance: none;
    width: 18px;
    height: 18px;
    border: 2px solid v.$border-color-secondary;
    border-radius: 4px;
    background-color: v.$background-light; // Use light background for checkbox itself
    cursor: pointer;
    position: relative;
    transition:
      background-color v.$transition-duration v.$transition-easing,
      border-color v.$transition-duration v.$transition-easing;

    &:checked {
      background-color: v.$primary-color;
      border-color: v.$primary-color;
      &::after {
        // Checkmark
        content: "";
        position: absolute;
        left: 5px;
        top: 1px;
        width: 4px;
        height: 9px;
        border: solid v.$text-color-primary; // White/light checkmark
        border-width: 0 2px 2px 0;
        transform: rotate(45deg);
      }
    }
    &:focus {
      outline: none;
      box-shadow: 0 0 0 2px rgba(v.$primary-color, 0.3);
    }
  }
}

/* --- Metric Filter Section --- */
.metricFilterContainer {
  display: flex;
  flex-direction: column;
  gap: 6px; // compact
  padding: 10px;
  background-color: v.$background-medium;
  border-radius: 8px;
}

.metricFilterHeader {
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
  gap: 8px;

  .label {
    font-size: 0.95em;
    font-weight: 600;
    color: v.$text-color-secondary;
    margin-right: auto;
  }
}

// Inline GP% toggle to avoid extra vertical block
.inlineGpToggle {
  display: flex;
  align-items: center;
}

// Inline Team Boost toggle placed near GP% to save vertical space
.inlineTeamBoostToggle {
  display: flex;
  align-items: center;
}

/* --- Layout Styles --- */

.gpGroupContainer {
  width: 100%;
  padding: 5px 0;
  border-bottom: 1px solid v.$border-color-secondary;
  margin-bottom: 15px;

  .metricGroupCheckboxes {
    justify-content: left;
    padding-left: 0;
    min-height: auto; // Don't need forced height for single checkbox
  }
}

.metricPresetButtons {
  display: flex;
  gap: 8px;
  flex-shrink: 0;
  button {
    // Align button visuals with Game Grid controls
    @include v.button-style;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    font-size: v.$font-size-sm;
    font-weight: 600;
    border-radius: v.$border-radius-md;
    padding: v.$space-xs v.$space-md;
    background: linear-gradient(
      135deg,
      rgba(255, 255, 255, 0.08),
      rgba(255, 255, 255, 0.04)
    );
    color: v.$text-secondary;
    border: 1px solid rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(12px);
    transition: all v.$transition-duration v.$transition-easing;
    position: relative;
    overflow: hidden;

    &::before {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(
        135deg,
        rgba(v.$secondary-color, 0.1),
        rgba(v.$primary-color, 0.05)
      );
      opacity: 0;
      transition: opacity v.$transition-duration v.$transition-easing;
    }
    &:hover:not(:disabled) {
      background: linear-gradient(
        135deg,
        rgba(255, 255, 255, 0.12),
        rgba(255, 255, 255, 0.08)
      );
      color: v.$text-color-primary;
      border-color: rgba(v.$secondary-color, 0.3);
      box-shadow:
        0 10px 15px rgba(0, 0, 0, 0.1),
        0 0 20px rgba(v.$secondary-color, 0.2);
      &::before {
        opacity: 1;
      }
    }
    &:active:not(:disabled) {
      transform: translateY(0);
      transition: transform 0.15s cubic-bezier(0.4, 0, 0.2, 1);
    }
    &:focus-visible {
      outline: none;
      z-index: 2;
      box-shadow: v.$focus-ring-desktop;
    }
    &:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }
  }
}

.sidebarFilters {
  .metricFilterContainer {
    padding: 12px;
    gap: 10px;
  }

  .metricFilterHeader {
    flex-direction: column;
    align-items: flex-start;
    gap: 6px;

    .label {
      margin-right: 0;
    }
  }

  .metricPresetButtons {
    width: 100%;
    flex-wrap: wrap;
    justify-content: space-between;

    button {
      flex: 1 1 calc(50% - 6px);
      min-width: 120px;
    }
  }
}

.skaterGoalieRow {
  display: flex;
  flex-direction: row;
  gap: 12px;

  @media (max-width: #{v.$breakpoint-tablet - 1px}) {
    flex-direction: column;
    gap: 15px;
  }
}

.sidebarFilters {
  .skaterGoalieRow {
    flex-direction: column;
    gap: 12px;
  }

  .skaterMetricsColumn,
  .goalieMetricsColumn {
    width: 100%;
  }

  .metricGroup {
    width: 100%;
  }

  .metricGroupCheckboxes {
    justify-content: flex-start;
  }
}

/* --- NEW: Styles for Metric Groups --- */
.metricGroupsWrapper {
  display: flex;
  flex-direction: column; // Stack groups vertically
  gap: 15px; // Space between individual groups (Points, Peripherals, etc.)
  margin-top: 5px; // Small space below the header
}

%metricsColumn {
  flex: 1;
  min-width: 0;
  border: 1px solid v.$primary-color;
  border-radius: 8px;
  padding: 10px 10px 10px 10px;
  position: relative;
  margin: 0;

  @media (max-width: #{v.$breakpoint-tablet - 1px}) {
    flex-basis: auto;
  }
}

.skaterMetricsColumn {
  @extend %metricsColumn;
}

.goalieMetricsColumn {
  @extend %metricsColumn;
}

.columnLabel {
  font-size: 1.1em;
  font-weight: bold;
  color: v.$border-color;
  padding: 0 10px;
  margin-left: 10px;
  // background-color: v.$background-medium; // Needed if border shows through legend
  width: auto;
  border: none;
}

// Containers for sub-groups (Points/Peripherals, Quality/Quantity)
.skaterSubGroupsRow,
.goalieSubGroupsRow {
  display: flex;
  flex-direction: row; // Side-by-side layout for sub-groups
  gap: 15px; // Gap between sub-groups

  @media (max-width: 600px) {
    // Stack sub-groups on very small screens if needed
    flex-direction: column;
    gap: 10px;
  }
}

// Styling for the individual group rendered by the helper
.metricGroup {
  flex: 1; // Allow sub-groups to share space equally
  min-width: 0; // Prevent flex overflow
  // background-color: rgba(v.$background-light, 0.1); // Optional subtle background
  // padding: 5px;
  // border-radius: 4px;
}

.metricGroupTitle {
  // Now a button, needs base styles + button resets
  display: block;
  width: 100%; // Make button take full width of its group
  font-weight: 600;
  font-size: 0.9em;
  color: v.$text-color-secondary;
  text-align: center;
  border-bottom: 1px solid v.$border-color-secondary; // Keep the separator look
  padding-bottom: 2px;
  margin-bottom: 6px;

  // Button Resets
  background: none;
  color: inherit;
  border: none;
  padding: 0; // Reset padding before re-applying specific padding
  padding-bottom: 3px; // Re-apply specific padding
  font: inherit;
  cursor: pointer;
  outline: inherit;
  transition: color 0.2s ease;

  &:hover,
  &:focus {
    color: v.$primary-color; // Highlight on hover/focus
    border-bottom-color: v.$primary-color;
  }
}

.metricGroupCheckboxes {
  display: flex;
  flex-direction: column;
  flex-wrap: nowrap;
  gap: 6px;
  align-items: stretch;
  justify-content: flex-start;
  padding-left: 0;
  min-height: 0;
}

.metricCheckbox {
  display: inline-flex;
  align-items: center;
  cursor: pointer;
  font-size: 0.85em;
  gap: 5px;
  color: v.$text-color-primary;
  white-space: nowrap;
  width: 100%;
  justify-content: flex-start;

  input[type="checkbox"] {
    // Style for metric INPUT checkbox
    appearance: none;
    width: 16px; // Slightly smaller than position checkboxes
    height: 16px;
    border: 2px solid v.$border-color-secondary;
    border-radius: 4px;
    background-color: v.$background-light; // Match checkbox background elsewhere
    cursor: pointer;
    position: relative;
    flex-shrink: 0; // Prevent checkbox shrinking if label is long
    transition:
      background-color v.$transition-duration v.$transition-easing,
      border-color v.$transition-duration v.$transition-easing;

    &:checked {
      background-color: v.$primary-color;
      border-color: v.$primary-color;
      &::after {
        // Checkmark
        content: "";
        position: absolute;
        left: 4px;
        top: 1px;
        width: 4px;
        height: 8px;
        border: solid v.$text-color-primary; // White/light checkmark
        border-width: 0 2px 2px 0;
        transform: rotate(45deg);
      }
    }
    &:focus {
      outline: none;
      box-shadow: 0 0 0 2px rgba(v.$primary-color, 0.3);
    }
  }
}

/* Reset Button Styling & Placement */
.buttonReset {
  // Align reset button with Game Grid button style
  @include v.button-style;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  font-size: v.$font-size-sm;
  font-weight: 700;
  border-radius: v.$border-radius-md;
  padding: v.$space-sm v.$space-lg;
  background: linear-gradient(
    135deg,
    rgba(255, 255, 255, 0.08),
    rgba(255, 255, 255, 0.04)
  );
  color: v.$text-secondary;
  border: 1px solid rgba(255, 255, 255, 0.15);
  backdrop-filter: blur(12px);
  transition: all v.$transition-duration v.$transition-easing;
  position: relative;
  overflow: hidden;
  &:hover:not(:disabled) {
    background: linear-gradient(
      135deg,
      rgba(255, 255, 255, 0.12),
      rgba(255, 255, 255, 0.08)
    );
    color: v.$text-color-primary;
    border-color: rgba(v.$secondary-color, 0.3);
    box-shadow:
      0 10px 15px rgba(0, 0, 0, 0.1),
      0 0 20px rgba(v.$secondary-color, 0.2);
  }
  align-self: center; // Center the button horizontally within the filters container
  margin-top: 10px; // Add some space above the button (gap also contributes)
  width: 100%;
  max-width: 300px; // Limit width of reset button
}

/* --- Name/Injury/Table/Pagination/Expanded Details Styling --- */
// --- (No changes below this line) ---

.nameAndInjuryWrapper {
  display: flex;
  flex-direction: column;
  width: 100%;
  height: 100%;
  justify-content: center; // Center vertically
  padding: 0; // tighter vertical padding
}
.leftNamePart {
  width: 100%;
  display: flex;
  align-items: center;
  text-align: left;
}
.rightInjuryPart {
  width: 100%;
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: flex-start; // Align left
  gap: 5px;
  font-size: 0.75em; // Smaller injury text
  color: v.$text-color-secondary; // Subdued color
  .statusRightInjuryPart {
    font-weight: bold;
    color: color.adjust(v.$color-red, $lightness: -10%);
    flex-shrink: 0;
  }
  .injuryNoteRightInjuryPart {
    // Allow wrapping but hide overflow
    overflow: hidden;
    white-space: nowrap;
    text-overflow: ellipsis;
  }
  .imageContainer {
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
    margin-left: auto; // Push image to the right if needed
  }
}

.playerName {
  font-weight: bold;
}

// Small inline team logo shown before the player's name
.teamLogoSmall {
  display: inline-flex;
  align-items: center;
  margin-right: 6px;
}

.teamAbbr {
  font-weight: 700;
  letter-spacing: 0.5px;
}

.tableContainer {
  margin-top: 0;
  overflow-x: auto;
  background: transparent;
  border-radius: 0;
  box-shadow: none;
  outline: none;
  // Subtle left accent on the first cell that does not affect layout
  table tr > td:first-child {
    box-shadow: inset 2px 0 0 rgba(0, 0, 0, 0.06);
  }
  @include v.custom-scrollbar(v.$secondary-color, v.$background-medium);
}

.inBottomDrawer {
  // Tuning knobs for the drawer split:
  // - Use percentages for a true ratio (recommended)
  // - Or swap to a fixed pixel width like `320px`
  --bpa-filters-width: 25%;

  height: 100%;
  min-height: 0;
  align-items: stretch;
  overflow: hidden;

  > .filters {
    flex: 0 0 var(--bpa-filters-width);
    width: var(--bpa-filters-width);
    height: 100%;
    min-height: 0;
    display: flex;
    flex-direction: column;
    padding: 0;
  }

  > .filters .filtersTitle {
    position: sticky;
    top: 0;
    z-index: 3;
  }

  > .filters .filtersBody {
    flex: 1 1 auto;
    min-height: 0;
    overflow: auto;
    padding: 12px;
    padding-right: 4px;
    @include v.custom-scrollbar(v.$secondary-color, v.$background-medium);
  }

  > .collapsibleContent {
    flex: 1 1 auto;
    height: 100%;
    min-height: 0;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  > .collapsibleContent .tableContainer {
    flex: 1 1 auto;
    min-height: 0;
    overflow: auto;
  }

  > .collapsibleContent .pagination {
    flex: 0 0 auto;
    margin-top: 0;
    padding: v.$space-sm v.$space-md;
    border-top: 1px solid rgba(v.$border-secondary, 0.6);
  }
}

.tableToolbar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: v.$space-md;
  padding: v.$space-sm v.$space-md;
  background-color: color.adjust(v.$background-dark, $lightness: -3%);
  border-bottom: 2px solid v.$border-secondary;
  box-shadow: v.$box-shadow-default;
}

.tableToolbarLeft {
  display: flex;
  align-items: baseline;
  gap: v.$space-sm;
  min-width: 0;
}

.tableToolbarTitle {
  font-family: v.$font-family-accent, sans-serif;
  text-transform: uppercase;
  letter-spacing: 0.08em;
  font-weight: 700;
  font-size: v.$font-size-md;
  color: v.$color-white;
  white-space: nowrap;
}

.tableToolbarAccent {
  color: v.$primary-color;
}

.tableToolbarMeta {
  font-family: v.$font-family-primary;
  font-size: v.$font-size-xs;
  color: v.$text-secondary;
  text-transform: uppercase;
  letter-spacing: 0.06em;
  white-space: nowrap;
}

.tableToolbarRight {
  display: inline-flex;
  align-items: center;
  gap: v.$space-sm;
  flex: 0 0 auto;
}

.toolbarButton {
  @include v.button-style;
  background: linear-gradient(135deg, v.$primary-color, v.$secondary-color);
  border: none;
  color: v.$color-white;
  font-family: v.$font-family-accent, sans-serif;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  padding: v.$space-xs v.$space-md;
  border-radius: v.$border-radius-sm;
  min-height: 28px;
  &:hover:not(:disabled) {
    transform: translateY(-1px);
    box-shadow: 0 8px 16px rgba(v.$primary-color, 0.25);
  }
  &:focus-visible {
    outline: none;
    box-shadow: v.$focus-ring-desktop;
  }
}

.numCell {
  font-family: v.$font-family-numbers, monospace;
  font-variant-numeric: tabular-nums;
  text-align: right;
}

.positionsCell {
  font-size: 12px;
  color: v.$text-secondary;
  text-align: center;
  white-space: nowrap;
}

.metricsCell {
  padding: 4px 6px;
  text-align: left;
  min-width: 340px;
}
.table {
  width: 100%;
  border-collapse: collapse;
  thead {
    position: sticky; // Cohesive sticky header like other tables
    top: 0;
    background-color: v.$background-dark;
    color: v.$text-color-secondary;
    z-index: 2; // Ensure header stays above body content
    th {
      border-collapse: collapse;
      background-color: color.adjust(v.$background-dark, $lightness: -2%);
      color: v.$color-white;
      font-weight: 900; // align with Game Grid header weight
      font-family: v.$font-family-accent, sans-serif; // Industrial Look
      font-size: 13px; // compact like Game Grid
      letter-spacing: 0.08em;
      text-transform: uppercase;
      height: v.$table-header-height; // Use variable if defined
      padding: v.$table-cell-padding; // Use variable if defined
      cursor: pointer;
      text-align: center;
      border-bottom: 2px solid v.$secondary-color;
      white-space: nowrap; // Prevent header text wrapping
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
    }
  }
  tbody {
    tr {
      font-family: v.$font-family-primary;
      text-align: center;
      transition: all 0.2s ease-out;
      background-color: transparent;
      position: relative;

      // Default accent if none set
      --accent-color: #{v.$primary-color};

      &:hover {
        background-color: rgba(255, 255, 255, 0.03);
        box-shadow:
          inset 0 0 20px rgba(0, 0, 0, 0.5),
          0 0 15px rgba(var(--accent-color), 0.15);
        z-index: 1;
        transform: scale(1.005);

        td:first-child {
          border-left: 3px solid var(--accent-color);
          box-shadow: 5px 0 15px -5px var(--accent-color);
        }
      }

      td {
        padding: 6px 6px;
        border: none;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        vertical-align: middle;
        font-size: 13px;
        box-sizing: border-box;
      }

      &.primaryRow {
        position: relative;
        // Removed decorative ::before stripe that caused subtle column misalignment
      }

      &.evenPair {
        background-color: color.adjust(v.$background-dark, $lightness: 4%);
      }

      &.oddPair {
        background-color: color.adjust(v.$background-medium, $lightness: 6%);
      }

      &.primaryRow:hover {
        background-color: color.adjust(v.$primary-color, $lightness: -35%);
      }
    }
  }
  // Special styling for first column (Name)
  thead th:first-child,
  tbody tr td:first-child {
    @include panel.first-col-separator(2px); // Unified separator width
    text-align: left;
    padding: v.$table-cell-padding; // Use variable
    font-size: 15px; // Slightly larger for name
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  // Override borders specifically for the Name column header/cells if needed
  thead th:first-child {
    border-bottom: 2px solid v.$secondary-color; // Keep header bottom border consistent
  }
  tbody tr td:first-child {
    border-bottom: 0.5px solid v.$border-color-secondary; // Match other body cells' bottom border
  }
}

// Explicit cell class for Name column to avoid layout glitches
// (no special styles at the moment)
// .nameCell {}

.percentileRow {
  display: flex;
  flex-wrap: nowrap; // keep to single line
  gap: 6px;
  justify-content: space-evenly;
  align-items: stretch;
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
}

.rowPairMetric {
  flex: 0 0 auto; // prevent wrapping per item
  min-width: 40px;
}

.emptyPercentile {
  font-size: 0.85em;
  color: v.$text-color-secondary;
}

.scoreCell {
  font-weight: 700;
  font-size: 1.1em;
  font-family: v.$font-family-numbers, monospace;
  color: v.$color-white;
  text-shadow: 0 0 10px rgba(v.$primary-color, 0.5);
}

.percentileContainer {
  // Individual metric box + label (Desktop & GP%)
  display: inline-flex; // Allows side-by-side layout within flex container
  flex-direction: column;
  align-items: center;
  transition: opacity v.$transition-duration v.$transition-easing; // For dimming

  &.dimmed {
    // Applied when filters are active, but this metric is NOT selected
    opacity: 0.3; // Dim non-selected metrics more aggressively
    filter: grayscale(100%);
  }
}

.percentileLabel {
  font-size: 0.7em;
  margin-bottom: 3px;
  color: v.$text-color-secondary;
  white-space: nowrap;
  text-transform: uppercase;
  letter-spacing: 0.05em;
  transition: color v.$transition-duration v.$transition-easing;

  // Style for selected label is applied directly via class
  &.selectedLabel {
    color: var(
      --metric-color,
      $metric-border-color
    ); // Match the dynamic metric color
    font-weight: 900; // Optional
    text-shadow: 0 0 8px var(--metric-color, $metric-border-color);
  }
}

.percentileBox {
  padding: 4px 6px; //  padding consistent
  border-radius: 4px;
  font-size: 0.95em;
  font-family: v.$font-family-numbers, monospace;
  font-weight: bold;
  text-align: center;
  min-width: 38px;
  color: v.$text-color-primary;
  box-sizing: border-box;
  transition: all v.$transition-duration v.$transition-easing; // Transition border color

  // Add transparent border by default to reserve space
  border: 1px solid rgba(255, 255, 255, 0.1);
  background: rgba(0, 0, 0, 0.2);

  // Apply border color only when selected class is present
  &.selectedBox {
    border-color: var(
      --metric-color,
      $metric-border-color
    ); // Use the dynamic color
    background: rgba(var(--metric-color, $metric-border-color), 0.1);
    box-shadow: 0 0 10px rgba(var(--metric-color, $metric-border-color), 0.2);
    color: v.$color-white;
  }
}

.pagination {
  display: flex;
  justify-content: space-evenly;
  align-items: center;
  margin-top: 12px; // tighter spacing
  padding: 6px 0;
  gap: 20px;
  button {
    // Align pagination buttons with Game Grid button style
    @include v.button-style;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    font-size: v.$font-size-sm;
    font-weight: 600;
    border-radius: v.$border-radius-md;
    padding: v.$space-xs v.$space-md;
    background: linear-gradient(
      135deg,
      rgba(255, 255, 255, 0.08),
      rgba(255, 255, 255, 0.04)
    );
    color: v.$text-secondary;
    border: 1px solid rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(12px);
    transition: all v.$transition-duration v.$transition-easing;
    position: relative;
    overflow: hidden;
    &::before {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(
        135deg,
        rgba(v.$secondary-color, 0.1),
        rgba(v.$primary-color, 0.05)
      );
      opacity: 0;
      transition: opacity v.$transition-duration v.$transition-easing;
    }
    &:hover:not(:disabled) {
      background: linear-gradient(
        135deg,
        rgba(255, 255, 255, 0.12),
        rgba(255, 255, 255, 0.08)
      );
      color: v.$text-color-primary;
      border-color: rgba(v.$secondary-color, 0.3);
      box-shadow:
        0 10px 15px rgba(0, 0, 0, 0.1),
        0 0 20px rgba(v.$secondary-color, 0.2);
      &::before {
        opacity: 1;
      }
    }
    &:active:not(:disabled) {
      transform: translateY(0);
      transition: transform 0.15s cubic-bezier(0.4, 0, 0.2, 1);
    }
    &:focus-visible {
      outline: none;
      z-index: 2;
      box-shadow: v.$focus-ring-desktop;
    }
    &:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }
  }
  span {
    font-family: v.$font-family-primary;
    font-size: 16px;
    color: v.$text-color-primary;
  }
}

/* --- Mobile Table Specific Styles --- */
.expandButton {
  background: transparent;
  border: none;
  color: v.$primary-color;
  font-size: 1.5rem;
  cursor: pointer;
  padding: 0 5px;
  transition:
    transform v.$transition-duration v.$transition-easing,
    color v.$transition-duration v.$transition-easing;
  line-height: 1; // Prevent extra spacing
  display: inline-flex; // Ensure proper alignment
  align-items: center;
  justify-content: center;
  &:hover {
    transform: scale(1.1);
    color: v.$secondary-color;
  }
}

.containerMobile {
  // Wrapper for mobile table
  overflow-x: auto; // Allow horizontal scroll if needed, though less likely now
  outline: none;
  background: transparent;
  border: none;
  border-radius: 0;
  margin-top: 0;
}
.tableMobile {
  width: 100%;
  border-collapse: collapse;
  border: none; // Remove outer border, handled by container
  border-radius: 0; // No radius inside container

  thead {
    position: sticky;
    top: 0;
    z-index: 2;
    background-color: v.$background-dark;
    tr {
      border-bottom: 3px solid v.$secondary-color;
    }
    th {
      padding: 8px 5px;
      font-size: 11px; // Smaller header font on mobile
      font-weight: 700;
      color: v.$text-color-secondary;
      background-color: v.$background-dark;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      text-align: center;
      border-right: 1px solid v.$border-color-primary; // Vertical separator lines
      white-space: nowrap;
      cursor: pointer;
      &:first-child {
        // Expand button column
        text-align: center;
        border-right: none;
        width: 5%; // Ensure width consistency with colgroup
        cursor: default; // Not sortable
      }
      &:last-child {
        border-right: none;
      }
    }
  }
  tbody {
    tr {
      border-bottom: 1px solid v.$border-color-secondary;
      transition: background-color v.$transition-duration v.$transition-easing;
      &:last-child:not(.expandedRow) {
        // Avoid double border with expanded row
        border-bottom: none;
      }
      &:nth-child(even) {
        background-color: v.$background-light;
      }
      &:nth-child(odd) {
        background-color: v.$background-dark;
      }
      &:hover:not(.expandedRow) {
        // Don't highlight expanded row itself on hover
        background-color: color.scale(v.$primary-color, $lightness: -30%);
      }
    }
    td {
      padding: 8px 5px;
      font-size: 13px;
      text-align: center;
      vertical-align: middle;
      border-right: 1px solid v.$border-color-secondary;
      &:first-child {
        // Expand button cell
        padding: 0; // Remove padding for button
        border-right: none;
        vertical-align: middle;
      }
      &:nth-child(2) {
        // Name column
        text-align: left;
      }
      &:last-child {
        border-right: none;
      }
    }
  }
  .expandedRow {
    background-color: color.scale(
      v.$background-medium,
      $lightness: -5%
    ) !important; // Slightly darker than even rows
    border-bottom: 2px solid v.$secondary-color; // Clear separation
    td {
      padding: 15px 10px; // More padding for expanded content
      border: none; // No internal borders for expanded cell
    }
  }
}

.expandedDetails {
  // Container within the expanded cell
  display: flex;
  flex-direction: column;
  align-items: center; // Center rows horizontally
  gap: 10px; // Space between rows of stats
  width: 100%;
}

.detailRow {
  // A row of stats within the expanded view
  display: flex;
  flex-wrap: wrap;
  justify-content: center; // Center stats horizontally
  align-items: stretch; // Make items equal height if needed
  gap: 8px; // Gap between individual stats
  width: 100%;
}

.detailItem {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  background-color: v.$background-dark;
  border-radius: 6px;
  padding: 5px;
  min-width: 55px;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
  flex-grow: 1;
  flex-basis: 0;
  transition: opacity v.$transition-duration v.$transition-easing;

  &.dimmed {
    opacity: 0.6;
  }
}

.detailLabel {
  font-size: 0.7em;
  margin-bottom: 3px;
  color: v.$text-color-secondary;
  text-align: center;
  white-space: nowrap;
  transition: color v.$transition-duration v.$transition-easing;

  &.selectedLabel {
    color: var(--metric-color, $metric-border-color);
  }
}

.detailValue {
  font-weight: bold;
  text-align: center;
  font-size: 1.1em;
  padding: 4px; // Keep padding consistent
  border-radius: 4px;
  color: v.$text-color-primary;
  width: 100%;
  box-sizing: border-box;
  transition: border-color v.$transition-duration v.$transition-easing; // Transition border color

  // Add transparent border by default
  border: $selected-border-width solid transparent; // Use same width as desktop

  // Apply border color only when selected class is present
  &.selectedBox {
    border-color: var(
      --metric-color,
      $metric-border-color
    ); // Match dynamic color
  }
}

.nameAndInjuryWrapperMobile {
  // Container for Name + Injury Icon on mobile rows
  display: flex;
  flex-direction: row;
  align-items: center;
  width: 100%;
}

.leftNamePartMobile {
  flex-grow: 1; // Allow name to take available space
  display: flex;
  align-items: center;
  text-align: left;
  overflow: hidden; // Prevent long names breaking layout
  .playerName {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
}
.rightInjuryPartMobile {
  // Injury icon container
  flex-shrink: 0; // Prevent injury icon shrinking
  display: flex;
  align-items: center;
  justify-content: flex-end; // Align icon to the right
}

/* --- Styles for the Collapsible Table/Pagination Content --- */
.collapsibleContent {
  transition:
    max-height 0.4s v.$transition-easing,
    opacity 0.3s v.$transition-easing,
    visibility 0.3s v.$transition-easing,
    margin-top 0.4s v.$transition-easing;
  max-height: 5000px; // Arbitrarily large height when visible
  opacity: 1;
  visibility: visible;
  overflow: visible; // Allow potential box shadows etc to show from table container
  width: 100%;
  padding: v.$space-md;

  // Styles when filters are minimized (applied via parent .containerMinimized)
  .containerMinimized & {
    // Target .collapsibleContent when parent has .containerMinimized
    max-height: 0;
    opacity: 0;
    visibility: hidden;
    margin-top: 0;
    overflow: hidden; // Hide content completely
  }
}

.message {
  // Loading/No results message
  padding: 30px 20px;
  text-align: center;
  color: v.$text-color-secondary;
  font-size: 1.1em;
}
